# JavaScript Tetris 仕様書

## 概要
JavaScriptで実装されたシンプルなテトリスゲーム。Canvas APIを使用してブラウザ上で動作します。

## ゲームの特徴
1. **基本システム**
   - フィールドサイズ: 10×20ブロック
   - ブロックサイズ: 30px
   - 更新レート: requestAnimationFrame使用
   - 自動落下速度: 1秒間隔

2. **テトリミノ**
   - 7種類の標準的なテトリミノ（I, O, T, S, Z, J, L）
   - SRSローテーションシステム実装
   - O型以外のテトリミノで回転可能
   - 壁蹴り機能あり

3. **表示機能**
   - ゴースト（落下予測位置）表示
   - 次のテトリミノ表示
   - スコア表示
   - グリッド表示
   - ゲームオーバー画面

4. **操作方法**
   - ←→: 左右移動
   - ↑: 回転
   - ↓: ソフトドロップ（1マス落下）
   - スペース: ハードドロップ（即時落下）
   - R: リトライ（ゲームオーバー時）
   - Q: ゲーム終了（ゲームオーバー時）

5. **スコアシステム**
   - 基本点: 100点/ライン
   - ボーナス: ライン数の2乗で計算
   - 例: 4ライン消し = 1600点（100 * 4 * 4）

6. **視覚効果**
   - ライン消去時のフラッシュエフェクト
   - 1ライン消し: 白色フラッシュ（3回）
   - 複数ライン消し: 虹色フラッシュ（5回）
   - 半透明オーバーレイのゲームオーバー画面

## 技術仕様
1. **クラス構造**
   - Tetrisクラスで全機能を管理
   - コンストラクタでゲーム初期化とイベントバインド
   - 非同期処理によるゲームループ制御

2. **状態管理**
   - isRunning: メインループ制御フラグ
   - gameOver: ゲームオーバー状態フラグ
   - currentRotationState: 現在の回転状態

3. **描画システム**
   - Canvas 2D Context使用
   - 二重バッファリングなし（シンプル実装）
   - requestAnimationFrameによる描画同期

4. **データ構造**
   - フィールド: 2次元配列（20×10）
   - テトリミノ: 形状を2次元配列で定義
   - 色情報: オブジェクトで管理

## 制限事項
1. ホールド機能なし
2. レベルシステムなし（固定速度）
3. ハイスコア保存機能なし
4. 設定変更機能なし
5. ゲーム終了（Q）キー機能が不完全

## 1. 画面構成
### プレイフィールド
- サイズ: 10×20マス
- ブロックサイズ: 30px
- 総画面サイズ:
  - 幅: 480px (プレイフィールド300px + サイドパネル180px)
  - 高さ: 600px (20マス × 30px)

### サイドパネル
- 幅: 180px (6マス × 30px)
- 背景色: RGB(30, 30, 30)
- 表示内容:
  - スコア
  - 次のテトリミノプレビュー

## 2. ゲームシステム
### テトリミノ
| 形状 | 色 |
|------|-----|
| I (長棒) | シアン |
| O (四角) | 黄色 |
| T (T字) | マゼンタ |
| S (S字) | 緑 |
| Z (Z字) | 赤 |
| J (逆L字) | 青 |
| L (L字) | オレンジ |

### 操作方法
- 移動: ←→キー
- 回転: ↑キー
- 高速落下: ↓キー（ソフトドロップ）
- 即時落下: スペースキー（ハードドロップ）
- リトライ: スペースキー（ゲームオーバー時）
- 終了: Qキー（ゲームオーバー時）

### ゲームメカニクス
- 自動落下速度: 1秒間隔
- スコア計算: (100 × 消したライン数) × 消したライン数
- 落下予測（ゴースト）表示: 白色の枠線（RGB(180, 180, 180)）

## 3. ビジュアルエフェクト
### グリッド表示
- 色: RGB(50, 50, 50)
- 表示範囲: プレイフィールド全体

### ライン消去エフェクト
#### 1列消去時
- 効果: 白色で点滅
- 点滅回数: 3回
- 点滅間隔: 30ミリ秒

#### 2列以上同時消去時
- 効果: 虹色で点滅
- 色順: 赤 → 黄 → 緑 → シアン → 青
- 点滅回数: 5回
- 点滅間隔: 30ミリ秒

## 4. UI表示
### スコア表示
- フォント: システムデフォルト
- サイズ: 36px
- 色: 白

### ゲームオーバー画面
- 表示内容:
  1. "GAME OVER"
  2. "Press SPACE to Retry"
  3. "Press Q to Quit"
- フォントサイズ: 48px
- 色: 白

## 5. 技術仕様
### 開発環境
- 言語: Python 3.x
- フレームワーク: Pygame
- フレームレート: 60FPS

### メインループ処理
1. イベント処理
2. 自動落下処理
3. 画面描画
4. FPS制御

### 実装済み機能クラス
- `Tetris`: メインゲームクラス
  - `__init__`: ゲーム初期化
  - `new_piece`: 新しいテトリミノ生成
  - `rotate_piece`: テトリミノ回転
  - `is_valid_move`: 移動可能判定
  - `merge_piece`: テトリミノ固定
  - `clear_lines`: ライン消去処理
  - `get_ghost_position`: ゴースト位置計算
  - `draw`: 画面描画
  - `reset_game`: ゲームリセット
  - `run`: メインループ

## 6. 今後の拡張案
1. レベルシステム
   - 時間経過による落下速度上昇
   - レベルに応じたスコア倍率

2. ハイスコア機能
   - スコアの永続化
   - ランキング表示

3. サウンド実装
   - 移動/回転効果音
   - ライン消去効果音
   - BGM

4. コンボシステム
   - 連続ライン消去のボーナス
   - コンボ数表示

5. Web対応
   - ブラウザでのプレイ対応
   - オンラインランキング
